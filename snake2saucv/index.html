<html>

<head>
    <style>
        * {
            user-select: none;
        }

        #scoreText {
            position: inline-block;
            font-size: 30px;
            text-align: center;
        }

        canvas {
            position: relative;
            left: 50%;
            transform: translateX(-50%);
            border: 1px solid black;
        }
    </style>
</head>

<body>
    <div id="div">
        <canvas id="gameBoard" width="700" height="700"></canvas>
        <p id="scoreText"></p>
    </div>

    <script>
        let gameBoard = document.querySelector("canvas");
        let ctx = gameBoard.getContext("2d");
        let tickSpeed = 150;
        let unitSize = 25;
        let xVel = unitSize, yVel = 0;
        let goingUp = false, goingDown = false, goingLeft = false, goingRight = true;
        let foodX, foodY;
        let snake = [
            { x: unitSize * 3, y: 0, color: "red" },
            { x: unitSize * 2, y: 0, color: "yellow" },
            { x: unitSize * 1, y: 0, color: "blue" },
            { x: 0, y: 0, color: "green" }
        ];
        let detected = false;
        let prevX, prevY;
        let score;
        let nr = 16777215;
        let foodColor = Math.floor(Math.random() * nr).toString(16);
        const scoreText = document.querySelector("#scoreText");

        window.addEventListener("keypress", detectDirection);
        window.addEventListener("click", () => {
            foodColor = Math.floor(Math.random() * nr).toString(16);
            growSnake();
            score++;
            scoreText.textContent = score;
        });

        start();
        setInterval(nextTick, tickSpeed);

        function start() {
            score = 0;
            scoreText.textContent = score;
            ctx.clearRect(-1, -1, gameBoard.width + 2, gameBoard.height + 2);
            tickSpeed = 50;
            unitSize = 25;
            xVel = unitSize, yVel = 0;
            goingUp = false, goingDown = false, goingLeft = false, goingRight = true;
            foodX, foodY;
            //snakeColor = Math.floor(Math.random()*nr).toString(16);
            snake = [
                { x: unitSize * 3, y: 0, color: "f00" },
                { x: unitSize * 2, y: 0, color: "ff0" },
                { x: unitSize * 1, y: 0, color: "00f" },
                { x: 0, y: 0, color: "0f0" }
            ];
            detected = false;
            drawSnake();
            drawFood();
            pickFoodLocation();
        }

        function nextTick() {
            if (detected)
                changeDirection();
            ctx.clearRect(-1, -1, gameBoard.width + 2, gameBoard.height + 2);
            prevX = snake[snake.length - 1].x;
            prevY = snake[snake.length - 1].y;
            moveSnake();
            isEating();
            drawFood();
            drawSnake();
            detected = false;
            death();
        }

        function death() {
            if (snake[0].x >= gameBoard.width || snake[0].y >= gameBoard.height || snake[0].x < 0 || snake[0].y < 0) {
                start();
            }
            else {
                for (let i = 1; i < snake.length; i++) {
                    if (snake[0].x == snake[i].x && snake[0].y == snake[i].y) {
                        start();
                    }
                }
            }
        }

        function isEating() {
            if (snake[0].x == foodX && snake[0].y == foodY) {
                score++;
                scoreText.textContent = score;
                growSnake();
                pickFoodLocation();
            }
        }

        function growSnake() {
            snake.push({ x: prevX, y: prevY, color: foodColor });
        }

        function pickFoodLocation() {
            foodColor = Math.floor(Math.random() * nr).toString(16);
            foodX = Math.round(Math.random() * (gameBoard.width - unitSize));
            foodY = Math.round(Math.random() * (gameBoard.height - unitSize));
            foodX -= foodX % unitSize;
            foodY -= foodY % unitSize;
            snake.forEach(el => {
                if (el.x == foodX && el.y == foodY)
                    pickFoodLocation();
            });
        }

        function drawFood() {
            ctx.fillStyle = "#" + foodColor;
            ctx.fillRect(foodX, foodY, unitSize, unitSize);
        }

        function detectDirection(event) {
            if (!detected) {
                resetDirections();
                function resetDirections() {
                    goingUp = false;
                    goingDown = false;
                    goingLeft = false;
                    goingRight = false;
                }
                switch (event.keyCode) {
                    case 119:
                        goingUp = true;
                        break;
                    case 100:
                        goingRight = true;
                        break;
                    case 115:
                        goingDown = true;
                        break;
                    case 97:
                        goingLeft = true;
                        break;
                    default:
                        break;

                }
                detected = true;
            }

        }

        function moveSnake() {
            for (let i = snake.length - 1; i >= 1; i--) {
                snake[i].x = snake[i - 1].x;
                snake[i].y = snake[i - 1].y;
            }
            snake[0].x += xVel;
            snake[0].y += yVel;
        }

        function drawSnake() {
            //ctx.strokeStyle = "white";
            snake.forEach(el => {
                //ctx.clearRect(el.x-1, el.y-1, unitSize+2, unitSize+2);
                ctx.fillStyle = '#' + el.color;
                ctx.strokeStyle = "black";
                ctx.fillRect(el.x, el.y, unitSize, unitSize);
                ctx.rect(el.x, el.y, unitSize, unitSize);
            });
            //ctx.stroke();
        }

        function changeDirection() {
            //xVel = 0, yVel = 0;
            if (goingUp && yVel != unitSize) {
                yVel = -unitSize;
                xVel = 0;
            }
            else if (goingDown && yVel != -unitSize) {
                yVel = unitSize;
                xVel = 0;
            }
            else if (goingLeft && xVel != unitSize) {
                xVel = -unitSize;
                yVel = 0;
            }
            else if (goingRight && xVel != -unitSize) {
                xVel = unitSize;
                yVel = 0;
            }
        }

    </script>
</body>

</html>